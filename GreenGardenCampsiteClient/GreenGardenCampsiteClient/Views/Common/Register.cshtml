@{
    ViewData["Title"] = "Register";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Source+Serif+Pro:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/Common/Register.css" asp-append-version="true" />
</head>
<body>
    <div class="container d-flex justify-content-between align-items-center vh-100">
        <div class="row w-100">
            <div class="col-md-6 d-flex flex-column justify-content-center align-items-start">
                <div class="logo mb-4">
                    <img src="https://wanee.vn/wp-content/uploads/2022/07/Campfire_icon_Pixabay_1345870-400x400.png" alt="Logo">
                </div>
                <h2>Sông Quê Green Garden</h2>
                <p>Nơi giúp bạn hoà mình vào thiên nhiên, thư giãn, khám phá sự bình yên</p>
            </div>

            <div class="col-md-6 d-flex align-items-center justify-content-center">
                <form id="registerForm" asp-action="Register" method="post" class="p-5 shadow rounded bg-white" style="width: 100%; max-width: 500px;">
                    <h2 class="mb-4 text-center">Đăng ký</h2>

                    <div class="mb-3">
                        <label for="firstname" class="form-label">First Name</label>
                        <input type="text" class="form-control" id="firstname" name="FirstName" placeholder="First Name" required>
                    </div>

                    <div class="mb-3">
                        <label for="lastname" class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="lastname" name="LastName" placeholder="Last Name" required>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="Email" placeholder="Email" required>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Mật khẩu</label>
                        <input type="password" class="form-control" id="password" name="Password" placeholder="Nhập mật khẩu" required>
                    </div>
                    <div class="mb-3">
                        <label for="PhoneNumber" class="form-label">Số điện thoại</label>
                        <input type="tel" class="form-control" id="PhoneNumber" name="PhoneNumber" placeholder="Nhập số điện thoại" required>
                    </div>


                    <div class="mb-3">
                        <label for="repeatPassword" class="form-label">Xác nhận mật khẩu</label>
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" placeholder="Xác nhận mật khẩu" required>
                    </div>

                    <div class="mb-3 d-flex align-items-center">
                        <div style="flex-grow: 1;">
                            <label for="verificationCode" class="form-label">Nhập mã xác thực</label>
                            <input type="text" class="form-control" id="verificationCode" name="VerificationCode" placeholder="Mã xác thực" required>
                            <!-- Dòng chữ thông báo khi nhấn nút lấy mã -->
                            <span id="waitingMessage" style="color: red; display: none;">Vui lòng chờ trong giây lát...</span>
                        </div>
                        <button type="button" class="btn btn-secondary ms-2" style="height: 38px; margin-top: 26px;" id="getCodeButton">Lấy mã</button>
                        <button type="button" class="btn btn-success ms-2" style="height: 38px; margin-top: 26px; display: none;" id="countdownButton">120s</button>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 mb-3">Đăng ký</button>

                    <div class="text-center">
                        <a href="#" class="text-decoration-none">Đăng nhập →</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.getElementById('getCodeButton').addEventListener('click', async function () {
            var email = document.getElementById('email').value;
            var waitingMessage = document.getElementById('waitingMessage');

            if (!email) {
                alert('Vui lòng nhập email trước khi lấy mã xác thực.');
                return;
            }

            // Hiển thị thông báo và vô hiệu hóa nút lấy mã
            waitingMessage.style.display = 'block';
            document.getElementById('getCodeButton').disabled = true;

            try {
                // Gửi yêu cầu để lấy mã xác thực
                let response = await fetch('/Common/SendVerificationCode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(email)
                });

                if (response.ok) {
                    startCountdown();  // Bắt đầu đếm ngược
                } else {
                    let error = await response.text();
                    alert(`Lỗi: ${error}`);
                }
            } catch (error) {
                alert(`Đã xảy ra lỗi: ${error}`);
            }
        });

        function startCountdown() {
            var getCodeButton = document.getElementById('getCodeButton');
            var countdownButton = document.getElementById('countdownButton');
            var countdown = 120;

            // Ẩn nút lấy mã và hiển thị nút đếm ngược (màu xanh lá cây)
            getCodeButton.style.display = 'none';
            countdownButton.style.display = 'inline';

            var interval = setInterval(function () {
                countdown--;
                countdownButton.textContent = countdown + 's';

                if (countdown <= 0) {
                    clearInterval(interval);
                    countdownButton.style.display = 'none';  // Ẩn nút đếm ngược
                    getCodeButton.style.display = 'inline';   // Hiển thị lại nút lấy mã
                    getCodeButton.disabled = false;  // Kích hoạt lại nút lấy mã
                    document.getElementById('waitingMessage').style.display = 'none'; // Ẩn thông báo
                }
            }, 1000);
        }

        //document.getElementById('registerForm').addEventListener('submit', async function (e) {
        //    e.preventDefault();

        //    var firstName = document.getElementById('firstname').value;
        //    var lastName = document.getElementById('lastname').value;
        //    var email = document.getElementById('email').value;
        //    var password = document.getElementById('password').value;
        //    var verificationCode = document.getElementById('verificationCode').value;

        //    // Kiểm tra hợp lệ cho tất cả các trường nhập
        //    if (!firstName || !lastName || !email || !password || !verificationCode) {
        //        alert('Vui lòng điền đầy đủ thông tin.');
        //        return;
        //    }

        //    var registrationData = {
        //        FirstName: firstName,
        //        LastName: lastName,
        //        Email: email,
        //        Password: password
        //    };

        //    try {
        //        let response = await fetch(`/Common/Register?enteredCode=${verificationCode}`, {
        //            method: 'POST',
        //            headers: { 'Content-Type': 'application/json' },
        //            body: JSON.stringify(registrationData)
        //        });

        //        if (response.ok) {
        //            alert('Đăng ký thành công!');
        //            window.location.href = '/Common/Home';
        //        } else {
        //            let errorData = await response.json();
        //            alert(`Lỗi: ${errorData.Error || 'Đăng ký không thành công.'}`);
        //        }
        //    } catch (error) {
        //        alert(`Đã xảy ra lỗi: ${error}`);
        //    }
        //});

    </script>
</body>
</html>
