@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
﻿
@using GreenGardenClient.Models;
@{
    var ticket = ViewBag.Ticket as List<TicketVM>;
    var ticketCategories = ViewBag.TicketCategories as List<TicketCategoryVM>;
}
<!doctype html>
<html lang="en">

<head>
    <title>Trips &mdash; Website Template by Colorlib</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Work+Sans:400,700,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    <link rel="stylesheet" href="~/fonts/icomoon/style.css">

    <link rel="stylesheet" href="~/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="~/css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="~/css/owl.carousel.min.css">
    <link rel="stylesheet" href="~/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="~/fonts/flaticon/font/flaticon.css">
    <link rel="stylesheet" href="~/css/aos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- MAIN CSS -->
    <link rel="stylesheet" href="~/css/style.css">

</head>

<body data-spy="scroll" data-target=".site-navbar-target" data-offset="300">


    <div class="site-wrap" id="home-section">

        <div class="site-mobile-menu site-navbar-target">
            <div class="site-mobile-menu-header">
                <div class="site-mobile-menu-close mt-3">
                    <span class="icon-close2 js-menu-toggle"></span>
                </div>
            </div>
            <div class="site-mobile-menu-body"></div>
        </div>



        <header class="site-navbar site-navbar-target" role="banner">
            <div class="container">
                <div class="row align-items-center position-relative">
                    <div class="col-3 ">
                        <div class="site-logo">
                            <a href="index.html" class="font-weight-bold">
                                <img src="~/images/logo3.jpg" alt="Image" class="img-fluid">
                            </a>
                        </div>
                    </div>
                    <div class="col-9 text-right">
                        <nav class="site-navigation text-right ml-auto d-none d-lg-block" role="navigation">
                            <ul class="site-menu main-menu js-clone-nav ml-auto ">
                                <li class="active"><a href="/Home" class="nav-link">Trang chủ</a></li>
                                <li><a href="/Common/Event" class="nav-link">Sự kiện</a></li>
                                <li class="has-dropdown">
                                    <a href="/Service" class="nav-link">Dịch vụ</a>
                                    <ul class="dropdown">
                                        <li><a href="/Service/OrderTicket" class="nav-link">Danh sách vé</a></li>
                                        <li><a href="/Service/OrderFoodAndDrink" class="nav-link">Danh sách đồ ăn</a></li>
                                        <li><a href="/Service/OrderGear" class="nav-link">Danh sách dụng cụ</a></li>
                                    </ul>
                                </li>

                                <li><a href="blog.html" class="nav-link">Liên hệ</a></li>
                                <li>
                                    @if (HttpContextAccessor.HttpContext.Session.GetString("Email") == null)
                                    {
                                        <a href="/Common/Login" class="nav-link">Đăng nhập</a>
                                        <a href="/Common/Register" class="nav-link">Đăng Ký</a>
                                    }
                                    else
                                    {
                                    <li class="has-dropdown">
                                        <a href="~/Common/UpdateProfile" class="nav-link" style="display: flex; align-items: center;">
                                            <div style="width: 30px; height: 30px; border-radius: 50%; overflow: hidden; margin-right: 8px;">
                                                <img src="~/images/img_1.jpg" alt="Trang cá nhân" style="width: 100%; height: 100%; object-fit: cover;">
                                            </div>
                                                @HttpContextAccessor.HttpContext.Session.GetString("Fullname")
                                        </a>


                                        <ul class="dropdown">
                                                @if (HttpContextAccessor.HttpContext.Session.GetInt32("RoleId") == 1)
                                                {
                                                <li><a href="~/DashBoard" class="nav-link">Quản lí</a></li>
                                                <li><a href="~/Home/Logout" class="nav-link">Đăng xuất</a></li>
                                                }
                                                else if (HttpContextAccessor.HttpContext.Session.GetInt32("RoleId") == 2)
                                                {
                                                <li><a href="~/OrderManagement/OrderOnline" class="nav-link">Quản lí</a></li>
                                                <li><a href="~/Home/Logout" class="nav-link">Đăng xuất</a></li>
                                                }
                                                else
                                                {

                                                <li><a href="~/Service/OrderHistory" class="nav-link">Lịch sử đặt hàng</a></li>
                                                <li><a href="~/Service/Cart" class="nav-link">Giỏ hàng</a></li>
                                                <li><a href="~/Home/Logout" class="nav-link">Đăng xuất</a></li>

                                                }
                                        </ul>

                                    </li>
                                    }

                                </li>
                                @if (HttpContextAccessor.HttpContext.Session.GetInt32("RoleId") == 3)
                                {
                                    <li>
                                        <a href="~/Service/Cart" class="nav-link">
                                            <i class="fas fa-shopping-cart"></i>
                                        </a>
                                    </li>

                                }

                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            <style>
                .site-menu .dropdown {
                    display: none; /* Ẩn menu thả xuống */
                    position: absolute; /* Để menu thả xuống xuất hiện bên dưới mục Services */
                    text-align: center;
                    background: #f0f0f0; /* Màu nền xám nhẹ cho menu thả xuống */
                    padding: 10px; /* Khoảng cách bên trong */
                    z-index: 999; /* Đảm bảo nó nằm trên các phần tử khác */
                }


                    .site-menu .dropdown li {
                        display: block; /* Hiển thị các mục theo chiều dọc */
                        margin: 5px 0; /* Khoảng cách giữa các mục theo chiều dọc */
                    }

                        .site-menu .dropdown li a {
                            padding: 5px 10px; /* Thêm khoảng cách bên trong cho các liên kết */
                            text-decoration: none; /* Bỏ gạch chân cho các liên kết */
                            color: #333; /* Màu chữ cho các liên kết */
                            transition: background-color 0.3s; /* Hiệu ứng chuyển màu nền */
                        }

                            .site-menu .dropdown li a:hover {
                                background-color: #e0e0e0; /* Màu nền khi hover vào các liên kết */
                            }

                .site-menu .has-dropdown:hover .dropdown {
                    display: block; /* Hiện menu thả xuống khi hover vào mục Services */
                }

                .filter-container {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 15px;
                    background-color: #fff;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                    margin-bottom: 20px;
                    gap: 20px; /* Khoảng cách giữa hai filter */
                }

                .filter-item {
                    display: flex;
                    flex-direction: column;
                    gap: 5px;
                    position: relative;
                    width: 50%; /* Cân chỉnh mỗi filter chiếm 50% không gian */
                }

                    .filter-item input, .filter-item select {
                        padding: 10px;
                        border-radius: 5px;
                        border: 1px solid #ccc;
                        font-size: 14px;
                        width: 100%; /* Đảm bảo độ rộng bằng với chiều rộng của filter-item */
                    }

                    .filter-item label {
                        font-size: 14px;
                        font-weight: bold;
                        color: #333;
                    }

                    /* Biểu tượng lịch cho input date */
                    .filter-item input[type="date"] {
                        padding-right: 40px;
                        background-size: 20px;
                        -webkit-appearance: none;
                        -moz-appearance: none;
                        appearance: none;
                        background-position: right 10px center;
                        background-repeat: no-repeat;
                    }

                    /* Biểu tượng sắp xếp cho select */
                    .filter-item select {
                        background-size: 20px;
                        appearance: none;
                        -webkit-appearance: none;
                        -moz-appearance: none;
                        padding-right: 40px;
                        background-position: right 10px center;
                        background-repeat: no-repeat;
                    }


                .product-list {
                    display: flex;
                    flex-direction: column;
                    gap: 20px;
                }

                .product-item {
                    display: flex;
                    justify-content: space-between; /* Căn hình ảnh và nội dung ra 2 phía */
                    align-items: center; /* Căn giữa theo chiều dọc */
                    background-color: #fff;
                    border-radius: 8px;
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                    padding: 15px;
                    margin-bottom: 20px;
                    width: 100%; /* Đảm bảo nó chiếm toàn bộ chiều rộng */
                }

                .product-image {
                    width: 200px; /* Điều chỉnh độ rộng của hình ảnh */
                    height: auto;
                    flex-shrink: 0; /* Đảm bảo hình ảnh không bị thu nhỏ */
                }

                    .product-image img {
                        width: 100%; /* Đảm bảo hình ảnh chiếm hết chiều rộng của container */
                        height: auto; /* Đảm bảo chiều cao tự điều chỉnh theo tỉ lệ của ảnh */
                        border-radius: 8px; /* Bo tròn các góc của hình ảnh */
                        object-fit: cover; /* Đảm bảo hình ảnh vừa khít mà không bị méo */
                    }

                .product-content {
                    flex-grow: 1; /* Đảm bảo phần nội dung chiếm hết không gian còn lại */
                    padding-left: 20px; /* Khoảng cách giữa ảnh và nội dung */
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    height: 100%; /* Đảm bảo chiều cao của nội dung bằng với chiều cao của hình ảnh */
                }

                .details-row {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 10px;
                }

                .price-quantity {
                    display: flex;
                    align-items: center;
                    gap: 20px; /* Khoảng cách giữa giá và thanh quantity */
                }

                .price {
                    font-size: 24px; /* Tăng kích thước font của giá */
                    color: red;
                    font-weight: bold;
                    line-height: 1; /* Đảm bảo chiều cao của text không vượt quá mức cần thiết */
                }

                .quantity-control {
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    overflow: hidden;
                    width: 100px;
                    height: 40px; /* Đảm bảo chiều cao phù hợp */
                    background-color: #fff;
                }

                    .quantity-control button {
                        background-color: transparent;
                        border: none;
                        cursor: pointer;
                        font-size: 18px; /* Kích thước font cho dấu +/- */
                        color: #ff6f61; /* Màu của dấu trừ và cộng */
                    }

                    .quantity-control input {
                        width: 30px; /* Độ rộng cho input */
                        text-align: center;
                        border: none;
                        font-size: 18px; /* Kích thước số hiển thị */
                        outline: none;
                        padding: 5px 0;
                        background-color: transparent;
                        color: #333; /* Màu số */
                    }

                .btn-group {
                    display: flex;
                    gap: 10px;
                    margin-top: 15px;
                }

                .add-to-cart, .buy-now {
                    padding: 10px 20px;
                    border-radius: 5px;
                    font-size: 14px;
                    cursor: pointer;
                }

                .add-to-cart {
                    background-color: #fff;
                    border: 1px solid #ffca28;
                    color: #ffca28;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .buy-now {
                    background-color: #ff6f61;
                    color: #fff;
                }

                .add-to-cart:hover {
                    background-color: #ffca28;
                    color: #fff;
                }

                .buy-now:hover {
                    background-color: #ff3f31;
                }

                .quantity-date-container {
                    display: flex;
                    justify-content: space-between; /* Sắp xếp các phần tử cách đều nhau */
                    align-items: center; /* Căn giữa theo chiều dọc */
                    gap: 20px; /* Khoảng cách giữa số lượng và ngày */
                    margin-top: 10px; /* Khoảng cách trên */
                }

                    .quantity-date-container p {
                        margin: 0;
                        font-size: 16px;
                        display: flex;
                        align-items: center;
                    }

                .styled-date {
                    padding: 8px 12px;
                    border: none; /* Loại bỏ border */
                    border-bottom: 2px solid transparent; /* Gạch ngang ban đầu trong suốt */
                    font-size: 16px;
                    color: #333;
                    background-color: #f9f9f9;
                    transition: border-bottom-color 0.3s ease; /* Hiệu ứng khi nhấn vào */
                    outline: none; /* Loại bỏ viền focus mặc định */
                    margin-left: -10px; /* Lùi sang trái 1 chút */
                }

                    .styled-date:focus {
                        border-bottom-color: #ff6f61; /* Đổi màu gạch ngang khi nhấn */
                    }

                    .styled-date::-webkit-calendar-picker-indicator {
                        background-color: #ffff;
                        padding: 5px;
                        border-radius: 50%;
                    }

            </style>
            <script>
                $(document).ready(function () {
                    $('.has-dropdown').hover(
                        function () {
                            $(this).find('.dropdown').stop(true, true).slideDown(200);
                        },
                        function () {
                            $(this).find('.dropdown').stop(true, true).slideUp(200);
                        }
                    );
                });


                function increaseQuantity(id) {
                    let quantityInput = document.getElementById(id);
                    let currentValue = parseInt(quantityInput.value);
                    if (!isNaN(currentValue)) {
                        quantityInput.value = currentValue + 1;
                    }
                }

                function decreaseQuantity(id) {
                    let quantityInput = document.getElementById(id);
                    let currentValue = parseInt(quantityInput.value);
                    if (!isNaN(currentValue) && currentValue > 1) {
                        quantityInput.value = currentValue - 1;
                    }
                }

            </script>


        </header>


        @* <div class="ftco-blocks-cover-1">
        <div class="site-section-cover overlay" style="background-image: url('@Url.Content("~/images/p22.jpg")')">
        <div class="container">
        <div class="row align-items-center justify-content-center text-center">
        <div class="col-md-5" data-aos="fade-up">
        <h1 class="mb-3 text-white">Đặt vé</h1>
        <p>Dịch vụ đặt vé tại Sông Quê Green Garden Campin mang đến trải nghiệm thuận tiện và nhanh chóng cho du khách. Chỉ với vài thao tác đơn giản qua trang web, bạn có thể dễ dàng chọn loại vé phù hợp với nhu cầu</p>
        </div>
        </div>
        </div>
        </div>
        </div>
        *@

        <div class="site-section">
            <div class="container">
                <div class="row justify-content-center text-center">
                    <div class="col-md-7">
                        <div class="heading-39101 mb-5">
                            <span class="backdrop text-center">Đặt vé</span>
                            <span class="subtitle-39191">Đặt vé</span>
                            <h3>Phần đặt vé tại đây</h3>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!-- Cột bên trái: Danh sách category -->
                    <div class="col-lg-3 col-md-4 mb-4" data-aos="fade-up">
                        <div class="category-list">
                            <h4 class="mb-4">Các loại vé</h4>
                            <ul id="categoryFilter" class="list-group">

                                <li class="list-group-item">
                                    <a class="@(ViewBag.CurrentCategoryId == null ? "active-category" : "")"
                                       href="@Url.Action("OrderTicket", "Service", new { sortBy = ViewBag.SortBy })">Tất cả</a>
                                </li>
                                @foreach (var category in ticketCategories)
                                {
                                    <li class="list-group-item">
                                        <a href="@Url.Action("OrderTicket", new { categoryId = category.TicketCategoryId, sortBy = ViewBag.SortBy  })">@category.TicketCategoryName</a>
                                    </li>
                                }

                            </ul>
                        </div>
                    </div>


                    <!-- Cột bên phải: Danh sách sản phẩm -->
                    <div class="col-lg-9 col-md-8">

                        <div class="filter-container" data-aos="fade-up">
                            <!-- Ngày sử dụng -->
                            <!-- Sắp xếp theo -->
                            <div class="filter-item">
                                <label for="sort">Sắp xếp theo:</label>
                                <select id="sort" name="sort" onchange="sortCampingGears()">
                                    <option value="" @(ViewBag.sortBy == "" ? "selected" : "")>Mặc định</option>
                                    <option value="1" @(ViewBag.sortBy == "1" ? "selected" : "")>Giá tăng dần</option>
                                    <option value="2" @(ViewBag.sortBy == "2" ? "selected" : "")>Giá giảm dần</option>
                                </select>
                            </div>
                        </div>
                        <div class="product-list" data-aos="fade-up">
                            @if (ticket != null && ticket.Any())
                            {
                                foreach (var item in ticket)
                                {
                                    <div class="product-item" id="product-@item.TicketId">
                                        <div class="product-image">
                                            <img src="~/images/img_1.jpg" alt="Image" class="img-fluid">
                                        </div>
                                        <div class="product-content">
                                            <h2><a href="@Url.Action("TripSingle", new { id = item.TicketId })">Vé @item.TicketName</a></h2>
                                            <p><i class="fa fa-info-circle"></i> Mô tả: Vé đơn giúp bạn trải nghiệm không gian cắm trại và tổ chức tiệc ngoài trời rộng rãi.</p>

                                            <div class="price-quantity">
                                                <p style="margin-bottom:1px" class="price"><i class="fa fa-money-bill-wave"></i> @item.Price.ToString("N0")đ</p>
                                            </div>

                                            
                                            <div class="btn-group">
                                                <form method="post" action="/Service/AddToCart">
                                                    <input type="hidden" name="Id" value="@item.TicketId" />
                                                    <input type="hidden" name="Name" value="@item.TicketName" />
                                                    <input type="hidden" name="CategoryName" value="@item.TicketCategoryName" />
                                                    <input type="hidden" name="Type" value="Ticket" />
                                                    <input type="hidden" name="TypeCategory" value="TicketCategory" />
                                                    <input type="hidden" name="price" value="@item.Price" />
                                                    <input type="hidden" name="quantity" value="1" />
                                                    <!-- Input ẩn để lưu ngày sử dụng được chọn -->
                                                    <input type="hidden" id="hidden-date-@item.TicketId" name="usageDate" />
                                                    <input type="hidden" name="redirectAction" value="OrderTicket" />
                                                    <button type="submit" class="add-to-cart" onclick="return setUsageDate('@item.TicketId')">
                                                        <i class="fa fa-cart-shopping"></i> Thêm giỏ hàng
                                                    </button>
                                                </form>
                                                <a href="@Url.Action("TicketDetail", "Service", new { ticketId = item.TicketId })" class="buy-now">Xem chi tiết</a>
                                            </div>                                          
                                        </div>
                                    </div>
                                }
                            }
                            else
                            {
                                <p>Không có vé nào.</p>
                            }
                        </div>
                    </div>
                </div>



            </div>


            <footer class="site-footer bg-light">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-3">
                            <h2 class="footer-heading mb-3">Facebook</h2>
                            <div class="row">
                                <div class="col-4 gal_col">
                                    <a href="#"><img src="~/images/Picture1.jpg" alt="Image" class="img-fluid"></a>
                                </div>
                                <div class="col-4 gal_col">
                                    <a href="#"><img src="~/images/Picture8.jpg" alt="Image" class="img-fluid"></a>
                                </div>
                                <div class="col-4 gal_col">
                                    <a href="#"><img src="~/images/Picture7.jpg" alt="Image" class="img-fluid"></a>
                                </div>
                                <div class="col-4 gal_col">
                                    <a href="#"><img src="~/images/Picture4.jpg" alt="Image" class="img-fluid"></a>
                                </div>
                                <div class="col-4 gal_col">
                                    <a href="#"><img src="~/images/Picture13.jpg" alt="Image" class="img-fluid"></a>
                                </div>
                                <div class="col-4 gal_col">
                                    <a href="#"><img src="~/images/Picture6.jpg" alt="Image" class="img-fluid"></a>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-8 ml-auto">
                            <div class="row">
                                <div class="col-lg-6 ml-auto">
                                    <h2 class="footer-heading mb-4">Truy cập nhanh</h2>
                                    <ul class="list-unstyled">
                                        <li><a href="#">Facebook</a></li>
                                        <li><a href="#">Instagram</a></li>
                                        <li><a href="#">Tiktok</a></li>

                                    </ul>
                                </div>
                                <div class="col-lg-6">
                                    <h2 class="footer-heading mb-4">Phản hồi</h2>
                                    <p>Nơi bạn đưa ra những phản hồi về dịch vụ,nhân viên tại sông quê</p>
                                    <form action="#" class="d-flex" class="subscribe">
                                        <input type="text" class="form-control mr-3" placeholder="Phản hồi">
                                        <input type="submit" value="Send" class="btn btn-primary">
                                    </form>
                                </div>

                            </div>
                        </div>
                    </div>

            </footer>

        </div>
        <script src="https://cdn.jsdelivr.net/npm/aos@2.3.1/dist/aos.js"></script>
        <script>
            AOS.init({
                duration: 1200,
            });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="~/js/jquery-3.3.1.min.js"></script>
        <script src="~/js/jquery-migrate-3.0.0.js"></script>
        <script src="~/js/popper.min.js"></script>
        <script src="~/js/bootstrap.min.js"></script>
        <script src="~/js/owl.carousel.min.js"></script>
        <script src="~/js/jquery.sticky.js"></script>
        <script src="~/js/jquery.waypoints.min.js"></script>
        <script src="~/js/jquery.animateNumber.min.js"></script>
        <script src="~/js/jquery.fancybox.min.js"></script>
        <script src="~/js/jquery.stellar.min.js"></script>
        <script src="~/js/jquery.easing.1.3.js"></script>
        <script src="~/js/bootstrap-datepicker.min.js"></script>
        <script src="~/js/isotope.pkgd.min.js"></script>
        <script src="~/js/aos.js"></script>
        <script src="~/js/main.js"></script>
        <script>
            function sortCampingGears() {
                const sortValue = document.getElementById("sort").value;
                const categoryId = '@ViewBag.CurrentCategoryId'; // Lấy categoryId hiện tại từ ViewBag nếu có
                const url = `@Url.Action("OrderTicket", "Service")?categoryId=${categoryId}&sortBy=${sortValue}`;
                window.location.href = url;
            }
            function setUsageDate(ticketId) {
                var savedDate = sessionStorage.getItem('usageDateForAll');

                // Nếu đã có ngày lưu trong sessionStorage, sử dụng ngày đó và submit form mà không hiển thị popup
                if (savedDate) {
                    document.getElementById('hidden-date-' + ticketId).value = savedDate;
                    document.querySelector(`#product-${ticketId} form`).submit();
                } else {
                    // Hiển thị popup yêu cầu chọn ngày nếu chưa có ngày nào được lưu
                    Swal.fire({
                        title: 'Vui lòng chọn ngày sử dụng!',
                        input: 'date',
                        inputAttributes: {
                            min: new Date().toISOString().split('T')[0] // Đặt giá trị min là ngày hiện tại
                        },
                        inputPlaceholder: 'yyyy-MM-dd',
                        showCancelButton: true,
                        confirmButtonText: 'Xác nhận',
                        cancelButtonText: 'Hủy',
                        inputValidator: (value) => {
                            if (!value) {
                                return 'Bạn cần nhập ngày sử dụng!';
                            }
                            return null;
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            var usageDate = result.value;

                            // Lưu ngày sử dụng vào sessionStorage cho các vé sau trong cùng một phiên
                            sessionStorage.setItem('usageDateForAll', usageDate);

                            // Đặt ngày sử dụng vào input ẩn và submit form
                            document.getElementById('hidden-date-' + ticketId).value = usageDate;
                            document.querySelector(`#product-${ticketId} form`).submit();
                        }
                    });
                }
                return false;
            }


        </script>

        <style>
            /* CSS để hiển thị placeholder cho input date */
            input[type="date"]::before {
                content: attr(placeholder);
                color: #aaa;
            }

            input[type="date"]:focus::before,
            input[type="date"]:valid::before {
                content: '';
            }
        </style>
</body>

</html>